<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos</title>
    <link rel="stylesheet" href="/static/style-graficos.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <nav class="navbar container flex">
            <h2 class="logo"><a href="#">GreenTech.</a></h2>
            <ul class="nav-links flex">
                <li><a onclick="window.location.href='/perfil/{{ id_usuario }}'">Voltar</a></li>
            </ul>
        </nav>
    </header>

    <section class="graficos-container">
        <div class="filtro-graficos">
            <div class="filtro-wrapper">
                <span class="filtro-label">Histórico:</span>
                <div class="periodo-opcoes">
                    <button class="periodo-btn" data-periodo="7">Última Semana</button>
                    <button class="periodo-btn" data-periodo="30">Último Mês</button>
                    <button class="periodo-btn" data-periodo="365">Último Ano</button>                    
                </div>
            </div>
        </div>

        <div class="grafico-principal">
            <h3 class="grafico-titulo">Seu Desempenho Geral</h3>
            <canvas id="graficoPrincipal" width="400" height="200"></canvas>
        </div>

        <div class="graficos-secundarios">
            <div class="grafico-card">
                <h3 class="grafico-titulo">Consumo de Água</h3>
                <canvas id="graficoAgua"></canvas>
            </div>

            <div class="grafico-card">
                <h3 class="grafico-titulo">Consumo de Energia</h3>
                <canvas id="graficoEnergia"></canvas>
            </div>

            <div class="grafico-card">
                <h3 class="grafico-titulo">Resíduos Reciclados</h3>
                <canvas id="graficoResiduo"></canvas>
            </div>

            <div class="grafico-card">
                <h3 class="grafico-titulo">Emissão de CO₂ / Transporte</h3>
                <canvas id="graficoTransporte"></canvas>
            </div>
        </div>
    </section>

    <script>
        window.dadosGraficos = {
            mediaFinal: {{ media_final | tojson }},
            pontuacaoAgua: {{ pontuacao_agua | tojson }},
            pontuacaoEnergia: {{ pontuacao_energia | tojson }},
            pontuacaoResiduo: {{ pontuacao_residuo | tojson }},
            pontuacaoTransporte: {{ pontuacao_transporte | tojson }},
            datas: {{ datas | tojson }}  
        };

        const botoesPeriodo = document.querySelectorAll('.periodo-btn');

botoesPeriodo.forEach(button => {
    button.addEventListener('click', function() {
        // Remove a classe 'active' de todos os botões
        botoesPeriodo.forEach(b => b.classList.remove('active'));
        // Adiciona a classe 'active' no botão clicado
        this.classList.add('active');

        // Obtém o período selecionado
        const periodoSelecionado = this.getAttribute('data-periodo');

        // Atualiza a URL com o período selecionado (para enviar ao backend)
        window.location.href = `/perfil/{{ id_usuario }}/graficos?periodo=${periodoSelecionado}`;
    });
});

// Garantir que o botão 'active' seja marcado após o carregamento da página
const periodoAtual = new URLSearchParams(window.location.search).get('periodo');
if (periodoAtual) {
    const botaoAtivo = document.querySelector(`.periodo-btn[data-periodo="${periodoAtual}"]`);
    if (botaoAtivo) {
        botaoAtivo.classList.add('active');
    }
}

    </script>

</body>
<script src="/static/js/js-graficos.js" defer></script>
</html>

